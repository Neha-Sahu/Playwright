name: ECan Playwright Tests

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  test:
    runs-on: ubuntu-latest  # Free Microsoft-hosted runner

    steps:
    - uses: actions/checkout@v4  # Clones your repo

    - name: Use Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20'  # Matches your Playwright setup
        cache: 'npm'

    - name: Install dependencies
      run: npm ci  # Uses package-lock.json for exact versions

    - name: Install Playwright browsers
      run: npx playwright install --with-deps

    - name: Run Playwright tests
      run: npx playwright test  # Runs your ecan-simple.spec.ts

    - name: Upload test results
      uses: actions/upload-artifact@v4
      if: always()  # Always upload, even on failure
      with:
        name: playwright-report
        path: playwright-report/
        retention-days: 30  # Keeps reports for 30 days

    - name: Generate JUnit report for GitHub
      if: always()
      uses: dorny/test-reporter@v1
      with:
        name: Playwright Tests
        path: playwright-report/*.xml
        reporter: java-junit  # Shows results in GitHub's "Checks" tab
